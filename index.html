<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HTML5 Jigsaw Puzzle</title>
<style>
  body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  canvas {
    background: #222;
    border: 2px solid #fff;
  }
</style>
</head>
<body>
<canvas id="puzzle"></canvas>

<script>
const canvas = document.getElementById('puzzle');
const ctx = canvas.getContext('2d');

const img = new Image();
img.src = 'JIGSAW01.jpg'; // sample image
const rows = 10;
const cols = 10;
let pieces = [];
let pieceWidth, pieceHeight;
let draggedPiece = null;
let offsetX, offsetY;

img.onload = () => {
  canvas.width = img.width;
  canvas.height = img.height;

  pieceWidth = canvas.width / cols;
  pieceHeight = canvas.height / rows;

  // Create pieces
  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      pieces.push({
        x: Math.random() * (canvas.width - pieceWidth),
        y: Math.random() * (canvas.height - pieceHeight),
        originalX: x * pieceWidth,
        originalY: y * pieceHeight,
        row: y,
        col: x,
      });
    }
  }

  drawPieces();
};

function drawPieces() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (const p of pieces) {
    ctx.drawImage(
      img,
      p.col * pieceWidth,
      p.row * pieceHeight,
      pieceWidth,
      pieceHeight,
      p.x,
      p.y,
      pieceWidth,
      pieceHeight
    );
    ctx.strokeStyle = '#fff';
    ctx.strokeRect(p.x, p.y, pieceWidth, pieceHeight);
  }
}

canvas.addEventListener('mousedown', e => {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  for (let i = pieces.length - 1; i >= 0; i--) {
    const p = pieces[i];
    if (
      mouseX > p.x &&
      mouseX < p.x + pieceWidth &&
      mouseY > p.y &&
      mouseY < p.y + pieceHeight
    ) {
      draggedPiece = p;
      offsetX = mouseX - p.x;
      offsetY = mouseY - p.y;
      pieces.push(pieces.splice(i, 1)[0]); // bring to top
      break;
    }
  }
});

canvas.addEventListener('mousemove', e => {
  if (!draggedPiece) return;
  const rect = canvas.getBoundingClientRect();
  draggedPiece.x = e.clientX - rect.left - offsetX;
  draggedPiece.y = e.clientY - rect.top - offsetY;
  drawPieces();
});

canvas.addEventListener('mouseup', e => {
  if (!draggedPiece) return;

  // Snap to grid if close
  if (
    Math.abs(draggedPiece.x - draggedPiece.originalX) < pieceWidth / 3 &&
    Math.abs(draggedPiece.y - draggedPiece.originalY) < pieceHeight / 3
  ) {
    draggedPiece.x = draggedPiece.originalX;
    draggedPiece.y = draggedPiece.originalY;
  }

  draggedPiece = null;
  drawPieces();
});
</script>
</body>
</html>
