<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HTML5 Jigsaw Puzzle</title>
<style>
  body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  canvas {
    background: #222;
    border: 2px solid #444;
    cursor: grab;
  }
</style>
</head>
<body>

<canvas id="puzzleCanvas" width="600" height="600"></canvas>

<script>
const canvas = document.getElementById("puzzleCanvas");
const ctx = canvas.getContext("2d");

const rows = 3;
const cols = 3;
const pieces = [];
let selectedPiece = null;
let offsetX = 0;
let offsetY = 0;

const img = new Image();
img.src = "https://picsum.photos/600"; // replace with your image

img.onload = () => {
  const pieceWidth = img.width / cols;
  const pieceHeight = img.height / rows;

  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      pieces.push({
        sx: x * pieceWidth,
        sy: y * pieceHeight,
        x: Math.random() * (canvas.width - pieceWidth),
        y: Math.random() * (canvas.height - pieceHeight),
        correctX: x * pieceWidth,
        correctY: y * pieceHeight,
        w: pieceWidth,
        h: pieceHeight,
        placed: false
      });
    }
  }

  draw();
};

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (const p of pieces) {
    ctx.drawImage(
      img,
      p.sx, p.sy, p.w, p.h,
      p.x, p.y, p.w, p.h
    );
  }
}

canvas.addEventListener("mousedown", e => {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  for (let i = pieces.length - 1; i >= 0; i--) {
    const p = pieces[i];
    if (
      mouseX > p.x && mouseX < p.x + p.w &&
      mouseY > p.y && mouseY < p.y + p.h &&
      !p.placed
    ) {
      selectedPiece = p;
      offsetX = mouseX - p.x;
      offsetY = mouseY - p.y;
      pieces.push(pieces.splice(i, 1)[0]); // bring to top
      break;
    }
  }
});

canvas.addEventListener("mousemove", e => {
  if (!selectedPiece) return;

  const rect = canvas.getBoundingClientRect();
  selectedPiece.x = e.clientX - rect.left - offsetX;
  selectedPiece.y = e.clientY - rect.top - offsetY;
  draw();
});

canvas.addEventListener("mouseup", () => {
  if (!selectedPiece) return;

  const dx = selectedPiece.x - selectedPiece.correctX;
  const dy = selectedPiece.y - selectedPiece.correctY;
  const distance = Math.sqrt(dx * dx + dy * dy);

  if (distance < 20) {
    selectedPiece.x = selectedPiece.correctX;
    selectedPiece.y = selectedPiece.correctY;
    selectedPiece.placed = true;
  }

  selectedPiece = null;
  draw();
});
</script>

</body>
</html>
